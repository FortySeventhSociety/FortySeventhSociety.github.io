<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
	
    <title>47th Marketplace</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/v/dt/dt-2.1.3/datatables.min.css">
	<link rel="stylesheet" href="css/default.css">
	<style>
.chart-container {
    display: flex;
    justify-content: space-between; /* Distribuisce il grafico e le etichette con spazio tra loro */
    align-items: center;
    width: 70%; /* Mantiene la larghezza del contenitore al 100% */
    height: 500px; /* Imposta un'altezza fissa per il contenitore */
}

#resourceChart {
    width: 60%; /* Assegna il 60% della larghezza al grafico */
    height: 100%; /* Imposta l'altezza del grafico per adattarsi al contenitore */
}

#legendContainer {
    width: 35%; /* Assegna il 35% della larghezza alle etichette */
    padding-left: 20px; /* Aggiunge spazio tra il grafico e le etichette */
}


        /* Include the Dodec font */
        @font-face {
            font-family: 'Dodec';
            src: url('fonts/Dodec.ttf') format('truetype');
        }

        .dodec-font {
            font-family: 'Dodec', sans-serif;
        }

.custom-font {
    font-size: 24px; /* Dimensione del font */
    padding: 10px; /* Spaziatura interna */
    text-align: center; /* Centra il testo */
}

#refreshButton {
    background-color: transparent;  /* Sfondo trasparente */
    border: none;  
    padding: 2px 2px;             /* Spaziatura interna */
    font-size: 18px;                /* Dimensione del testo */
    cursor: pointer;                /* Cambia il cursore quando si passa sopra il bottone */
}

#refreshButton:hover {
    background-color: rgba(0, 0, 0, 0.1);  /* Effetto al passaggio del mouse (trasparente con sfumatura leggera) */
}
</style>
</head>
<body>

    <div class="menu2">
        <label for="css-selector"><span>Themes:</span></label>
        <select id="css-selector" onchange="changeCSS(this.value)">
            <option value="css/default.css">Default</option>
			 <option value="css/cyber.css">Cyber</option>
            <option value="css/girls.css">Girls</option>
			<option value="css/neon.css">Neon</option>
            <!-- Aggiungi qui altre opzioni per i tuoi file CSS -->
        </select>
    </div>
	<div class="header-section">
	<h1>Data The Destoyer's</h1>
        <h2><a href="https://kingdom.so/?ref=btrpazme" target="_blank">Kingdom.so Marketplace</a></h2>
	<div class="tabs">
        <div class="tab active" data-tab="tab1">Buy items</div>
        <div class="tab" data-tab="tab2">Sell Items</div>
		<div class="tab" data-tab="tab5">üëú</div>
        <div class="tab" data-tab="tab6">üè∞</div>
    </div>
	</div>
 <div id="tab1" class="tab-content active">
        <div class="table-section buy">
            <div class="filter-group buy">
                <label for="categoryFilterBuy">Category:</label>
                <select id="categoryFilterBuy">
                    <option value="">All</option>
                </select>
                <label for="subcategoryFilterBuy">Subcategory:</label>
                <select id="subcategoryFilterBuy">
                    <option value="">All</option>
                </select>
            </div>

            <table id="toBuyTable" class="display" style="width:100%">
                <thead>
                    <tr>
                        <th></th>
                        <th>Object</th>
                        <th>Category</th>
                        <th>Subcategory</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th></th>
                        <th>Seller</th>
                    </tr>
                </thead>
            </table>
        </div>
		</div>
		

	<div id="tab2" class="tab-content">
        <div class="table-section sell">
            <div class="filter-group sell">
                <label for="categoryFilterSell">Category:</label>
                <select id="categoryFilterSell">
                    <option value="">All</option>
                </select>
                <label for="subcategoryFilterSell">Subcategory:</label>
                <select id="subcategoryFilterSell">
                    <option value="">All</option>
                </select>
            </div>

            <table id="toSellTable" class="display" style="width:100%">
                <thead>
                    <tr>
                        <th></th>
                        <th>Object</th>
                        <th>Category</th>
                        <th>Subcategory</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th></th>
                        <th>Seller</th>
                    </tr>
                </thead>
            </table>
    </div>
	</div>

<div id="tab6" class="tab-content">
    <div class="table-section sell"> <!-- Usa la classe 'sell' per copiare lo stile -->
    <div class="dodec-font">
        <!--
        <div class="dodec-font"><div class="custom-font">The Politics Of The Forty Seventh Society Kingdoms</div></div>
    -->
    <br/>
<center>
<h3>Introduction</h3>

<h4>Kingdom is a multiplayer casual, cozy web3 game with a player-controlled economy where you can create your own kingdom, collect resources, make friends, craft objects, farm and trade.
<br/>
You can play kingdom on desktop and mobile directly at <a href="https://kingdom.so/?ref=btrpazme" target="_blank">Kingdom.so</a></h4>
<h5>* The information provided on this website does not constitute investment advice, financial advice, trading advice, or any other sort of advice and you should not treat any of the website‚Äôs content as such. Thought Canopy Co SASU does not recommend that any cryptocurrency should be bought, sold, or held by you.</h5>
<h3>üéì Get started</h3>
<h4>This section will guide you through the initial steps to play Kingdom on either mobile or desktop.</h4>
<h3>Create your account</h3>
<h4>Creating an account on kingdom.so is simple and free. 
<br/>
Go to kingdom.so on desktop or mobile and click on Play Now
<br/>
Choose your username and avatar
<br/>
Sign in with email and password or with a Google account
<br/>
That‚Äôs it! Your avatar arrive on the central tile of kingdom, and you can now explore the world.</h4>
<h5>Alpha phase warning</h5>
<h6>Alpha means that the game is still a work in progress. By playing the alpha version you are contributing greatly to the future game‚Äôs development‚Äîbut you must expect setbacks and bugs.
<br/>
In exchange for your understanding and patience, the devs will often reward early adopters with special items, advantages, unique sales, exclusive access, and more.</h6>
<h5>Discord</h5>
<h6>We highly recommend joining us on <a href="https://discord.gg/3B5FedjYDE" target="_blank">Discord</a> to chat with the developers and discover new features and content.</h6>
</center>
<br/>
<br/>
    </div>
    </div>
</div>

    <div id="tab5" class="tab-content">
        <div class="table-section buy">
                        <div class="dodec-font"><div class="custom-font">Some Of The Items From Kingdom.so</div>
<div style="display: flex; justify-content: space-between; flex-wrap: wrap; width: 100%;">
    <table id="resourceTable" class="display" style="width: 18%; margin: 5px;">
        <thead>
            <tr>
                <th style="width: 50px;"></th>
                <th style="width: 100px;">Materials</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><img src="https://kingdom.so/_nuxt/img/gold.b8469d8.png" style="width:30px; height:30px;"></td>
                <td>Gold</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/wood_plank.png" style="width:30px; height:30px;"></td>
                <td>Wood Plank</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/stone_brick.png" style="width:30px; height:30px;"></td>
                <td>Stone Brick</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/clay_brick.png" style="width:30px; height:30px;"></td>
                <td>Clay Brick</td>
            </tr>
        </tbody>
    </table>

    <table id="resourceTable" class="display" style="width: 18%; margin: 5px;">
        <thead>
            <tr>
                <th style="width: 50px;"></th>
                <th style="width: 100px;">Gems</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><img src="https://kingdom.so/images/objects/amethyst.png" style="width:30px; height:30px;"></td>
                <td>Amethyst</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/emerald.png" style="width:30px; height:30px;"></td>
                <td>Emerald</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/ruby.png" style="width:30px; height:30px;"></td>
                <td>Ruby</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/sapphire.png" style="width:30px; height:30px;"></td>
                <td>Sapphire</td>
            </tr>
        </tbody>
    </table>

    <table id="resourceTable" class="display" style="width: 18%; margin: 5px;">
        <thead>
            <tr>
                <th style="width: 50px;"></th>
                <th style="width: 100px;">Raw Goods</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><img src="https://kingdom.so/images/objects/ingot_gold.png" style="width:30px; height:30px;"></td>
                <td>Ingot Gold</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/ingot_silver.png" style="width:30px; height:30px;"></td>
                <td>Ingot Silver</td>
            </tr>
                        <tr>
                <td><img src="https://kingdom.so/images/objects/ingot_iron.png" style="width:30px; height:30px;"></td>
                <td>Ingot Iron</td>
            </tr>
                                    <tr>
                <td><img src="https://kingdom.so/images/objects/cotton_thread.png" style="width:30px; height:30px;"></td>
                <td>Cotton Thread</td>
            </tr>
        </tbody>
    </table>

    <table id="resourceTable" class="display" style="width: 18%; margin: 5px;">
        <thead>
            <tr>
                <th style="width: 50px;"></th>
                <th style="width: 100px;">Thread</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><img src="https://kingdom.so/images/objects/cotton_thread_brown.png" style="width:30px; height:30px;"></td>
                <td>Brown Cotton Thread</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/cotton_thread_green.png" style="width:30px; height:30px;"></td>
                <td>Green Cotton Thread</td>
            </tr>
                        <tr>
                <td><img src="https://kingdom.so/images/objects/cotton_thread_orange.png" style="width:30px; height:30px;"></td>
                <td>Orange Cotton Thread</td>
            </tr>
                        <tr>
                <td><img src="https://kingdom.so/images/objects/cotton_thread_red.png" style="width:30px; height:30px;"></td>
                <td>Red Cotton Thread</td>
            </tr>
                        <tr>
                <td><img src="https://kingdom.so/images/objects/cotton_thread_yellow.png" style="width:30px; height:30px;"></td>
                <td>Yellow Cotton Thread</td>
            </tr>
                                    <tr>
                <td><img src="https://kingdom.so/images/objects/cotton_thread_blue.png" style="width:30px; height:30px;"></td>
                <td>Blue Cotton Thread</td>
            </tr>
        </tbody>
    </table>
        <table id="resourceTable" class="display" style="width: 18%; margin: 5px;">
        <thead>
            <tr>
                <th style="width: 50px;"></th>
                <th style="width: 100px;">Foodstuffs</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><img src="https://kingdom.so/images/objects/wrapped_potato.png" style="width:30px; height:30px;"></td>
                <td>Wrapped Potato</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/salad.png" style="width:30px; height:30px;"></td>
                <td>Salad</td>
            </tr>
                        <tr>
                <td><img src="https://kingdom.so/images/objects/mushroom_soup.png" style="width:30px; height:30px;"></td>
                <td>Mushroom Soup</td>
            </tr>
                        <tr>
                <td><img src="https://kingdom.so/images/objects/fries.png" style="width:30px; height:30px;"></td>
                <td>Fries</td>
            </tr>
        </tbody>
    </table>
</div>

<br/>
<br/>
                        </div>
<div class="dodec-font" style="display: flex; justify-content: space-between;">
    <div style="width: 48%;">
        <table class="display" style="width: 100%;">
            <tr>
                <th style="width: 50px;"></th>
                <th>Name</th>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/amethyst.png" style="width:30px; height:30px;"></td>
                <td>Amethyst</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/bread_oven.png" style="width:30px; height:30px;"></td>
                <td>Bread Oven</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/dyeing_vat.png" style="width:30px; height:30px;"></td>
                <td>Dyeing Vat</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/emerald.png" style="width:30px; height:30px;"></td>
                <td>Emerald</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/furnace.png" style="width:30px; height:30px;"></td>
                <td>Furnace</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/ingot_gold.png" style="width:30px; height:30px;"></td>
                <td>Gold Ingot</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/mill.png" style="width:30px; height:30px;"></td>
                <td>Mill</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/ruby.png" style="width:30px; height:30px;"></td>
                <td>Ruby</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/sapphire.png" style="width:30px; height:30px;"></td>
                <td>Sapphire</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/sawmill.png" style="width:30px; height:30px;"></td>
                <td>Sawmill</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/spinning_wheel.png" style="width:30px; height:30px;"></td>
                <td>Spinning Wheel</td>
            </tr>
            <tr>
                <td><img src="https://kingdom.so/images/objects/stonecutter.png" style="width:30px; height:30px;"></td>
                <td>Stone Cutter</td>
            </tr>
        </table>
    </div>

    <div style="width: 48%;">
        <table class="display" style="width: 100%;">
            <tr>
                <th>Resource</th>
                <th></th>
            </tr>
            <tr>
                <td>Wood</td>
                <td><img src="https://kingdom.so/images/objects/wood.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Stone</td>
                <td><img src="https://kingdom.so/images/objects/stone.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Iron</td>
                <td><img src="https://kingdom.so/images/objects/iron.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Iron Ingot</td>
                <td><img src="https://kingdom.so/images/objects/ingot_iron.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Silver</td>
                <td><img src="https://kingdom.so/images/objects/silver.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Silver Ingot</td>
                <td><img src="https://kingdom.so/images/objects/ingot_silver.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Gold</td>
                <td><img src="https://kingdom.so/images/objects/gold.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Gold Ingot</td>
                <td><img src="https://kingdom.so/images/objects/ingot_gold.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Amethyst</td>
                <td><img src="https://kingdom.so/images/objects/amethyst.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Clay</td>
                <td><img src="https://kingdom.so/images/objects/clay.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Ruby</td>
                <td><img src="https://kingdom.so/images/objects/ruby.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Sapphire</td>
                <td><img src="https://kingdom.so/images/objects/sapphire.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Emerald</td>
                <td><img src="https://kingdom.so/images/objects/emerald.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Stone Brick</td>
                <td><img src="https://kingdom.so/images/objects/stone_brick.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Clay Brick</td>
                <td><img src="https://kingdom.so/images/objects/clay_brick.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Cotton Thread</td>
                <td><img src="https://kingdom.so/images/objects/cotton_thread.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Wood Plank</td>
                <td><img src="https://kingdom.so/images/objects/wood_plank.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Wrapped Potato</td>
                <td><img src="https://kingdom.so/images/objects/wrapped_potato.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Fries</td>
                <td><img src="https://kingdom.so/images/objects/fries.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Salad</td>
                <td><img src="https://kingdom.so/images/objects/salad.png" style="width:30px; height:30px;"></td>
            </tr>
            <tr>
                <td>Mushroom Soup</td>
                <td><img src="https://kingdom.so/images/objects/mushroom_soup.png" style="width:30px; height:30px;"></td>
            </tr>
        </table>
    </div>
</div>










        </div>
    </div>

    <footer>
        <p><span id="year"></span>‚ù§Ô∏è <a href="https://kingdom.so/?ref=btrpazme" target="_blank">Data The Destroyer</a></p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script src="https://cdn.datatables.net/2.1.8/js/dataTables.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
$.fn.dataTable.ext.errMode = 'none';
$(document).ready(function() {
    // Inizializza DataTables per ogni tabella
    $('#table1').DataTable();
    $('#table2').DataTable();
    $('#table3').DataTable({
        pageLength: 30  // Imposta la lunghezza della pagina a 30
    });
	$('#table4').DataTable();
$('#ranking_table').DataTable();
$('#multiplied_ranking_table').DataTable();

    // Altre inizializzazioni

    // Gestione del click sulle tab
    $('.tab').on('click', function() {
        var tabId = $(this).data('tab');

        // Attiva la tab cliccata
        $('.tab').removeClass('active');
        $(this).addClass('active');

        // Mostra il contenuto corrispondente alla tab cliccata
        $('.tab-content').removeClass('active');
        $('#' + tabId).addClass('active');
    });

    const apiUrl = 'https://api.kingdom.so/open/marketplace';

    function createRow(item, type) {
        return [
            `<img src="${item.object.thumbnailImageUrl}" alt="${item.object.metadata.title}" style="width:16px; height:16px;">`,
            item.object.metadata.title,
            item.object.category,
            item.object.subCategory,
            item.pricing.unitPrice || item.pricing.desiredQuantity,
            item.pricing.availableQuantity || item.pricing.desiredQuantity,
            `<a href="${item.tile.url}" target="_blank" class="button ${type === 'buy' ? '' : 'sell'}">${type === 'buy' ? 'Buy' : 'Sell'}</a>`,
            item.tile.owner
        ];
    }

    function initDataTable(tableId, data, type) {
        // Verifica se DataTable √® gi√† inizializzato
        if ($.fn.DataTable.isDataTable(tableId)) {
            // Se s√¨, distruggilo prima di reinizializzare
            $(tableId).DataTable().clear().destroy();
        }

        // Inizializza DataTable
        $(tableId).DataTable({
            data: data.map(item => createRow(item, type)),
            columns: [
                { title: "", orderable: false },
                { title: "Object" },
                { title: "Category" },
                { title: "SubCat" },
                { title: "Price" },
                { title: "Qnt" },
                { title: "", orderable: false },
                { title: "Owner" }
            ],
            pageLength: 50,  // Imposta il numero di voci da mostrare a 50
            order: [[2, 'asc'], [3, 'asc'], [4, 'asc']],
            createdRow: function(row, data, dataIndex) {
                $(row).addClass(type === 'buy' ? 'buy-row' : 'sell-row');
            },
            language: {
                paginate: {
                    previous: "<",
                    next: ">"
                },
                lengthMenu: "Show _MENU_ entries",
                info: "Showing _START_ to _END_ of _TOTAL_ entries",
                infoFiltered: "(filtered from _MAX_ total entries)",
                search: "Search:"
            }
        });
    }

    function populateFilters(data, categoryFilter, subcategoryFilter) {
        const categories = [...new Set(data.map(item => item.object.category))];
        const subCategories = [...new Set(data.map(item => item.object.subCategory))];

        categoryFilter.empty();
        subcategoryFilter.empty();

        // Aggiungi l'opzione "ALL" per le categorie
        categoryFilter.append(new Option("All", ""));
        categories.forEach(category => {
            categoryFilter.append(new Option(category, category));
        });

        // Aggiungi l'opzione "ALL" per le sottocategorie
        subcategoryFilter.append(new Option("All", ""));
        subCategories.forEach(subCategory => {
            subcategoryFilter.append(new Option(subCategory, subCategory));
        });
    }

    function filterTableByCategoryAndSubcategory(tableId, categoryFilter, subcategoryFilter) {
        $(categoryFilter).on('change', function() {
            const category = $(this).val();
            const subcategory = $(subcategoryFilter).val();
            const table = $(tableId).DataTable();

            // Filtra in base alla categoria e sottocategoria
            table.columns(2).search(category || '').columns(3).search(subcategory || '').draw();
        });

        $(subcategoryFilter).on('change', function() {
            const subcategory = $(this).val();
            const category = $(categoryFilter).val();
            const table = $(tableId).DataTable();

            // Filtra in base alla sottocategoria e categoria
            table.columns(3).search(subcategory || '').columns(2).search(category || '').draw();
        });
    }

    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            const sortedToBuy = data.toBuy.sort((a, b) => a.object.category.localeCompare(b.object.category));
            const sortedToSell = data.toSell.sort((a, b) => a.object.category.localeCompare(b.object.category));

            initDataTable('#toBuyTable', sortedToBuy, 'buy');
            initDataTable('#toSellTable', sortedToSell, 'sell');

            populateFilters(sortedToBuy, $('#categoryFilterBuy'), $('#subcategoryFilterBuy'));
            populateFilters(sortedToSell, $('#categoryFilterSell'), $('#subcategoryFilterSell'));

            filterTableByCategoryAndSubcategory('#toBuyTable', '#categoryFilterBuy', '#subcategoryFilterBuy');
            filterTableByCategoryAndSubcategory('#toSellTable', '#categoryFilterSell', '#subcategoryFilterSell');
        });

    function loadInfoData() {
        $.ajax({
            url: 'load_info.php',
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                const table = $('#table3').DataTable();
                table.clear();

                response.forEach(item => {
                    table.row.add([
                        `<img src="${item.thumb_image}" alt="${item.name}" style="width:24px; height:24px;">`,
                        item.name,
                        item.category,
                        item.subcategory,
                        item.description
                    ]).draw();
                });
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error('Error loading data:', textStatus, errorThrown);
            }
        });
    }
	
	 function loadTable4Data() {
        $.ajax({
            url: 'load_placeholder.php', 
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                const table = $('#table4').DataTable();
                table.clear();

                response.forEach(item => {
                    table.row.add([
                        `<img src="${item.image_path}" alt="${item.name}" style="width:50px; height:50px; display: block; margin: 0 auto;">`,
                        item.name,         // Colonna nome
                        item.description,  // Colonna descrizione
						`<a href="${item.url}" target="_blank" class="button sell">GO</a>`  // Pulsante di collegamento
                    ]).draw();
                });
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error('Error loading data for Table 4:', textStatus, errorThrown);
            }
        });
    }
	
function loadRankingData() {
    $.ajax({
        url: 'load_ranking.php',
        type: 'GET',
        dataType: 'json',
        success: function(response) {
            console.log("Ranking Data Response:", response); // Debug

            var rankingTable = $('#ranking_table').DataTable();
            rankingTable.clear().draw();

            if (Array.isArray(response.rankings)) {
                response.rankings.forEach(item => {
                    // Verifica che l'oggetto abbia esattamente 3 attributi
                    if (item.username && item.total_amount && item.resource) {
                        rankingTable.row.add([
                            item.username || 'N/A',
                            item.total_amount || 'N/A',
                            item.resource || 'N/A'
                        ]).draw();
                    } else {
                        console.warn("Skipping item due to missing attributes:", item);
                    }
                });
            } else {
                console.error("Expected an array under 'rankings' key.");
                rankingTable.row.add(['Error loading rankings', '', '']).draw();
            }

var multipliedRankingTable = $('#multiplied_ranking_table').DataTable({
    "order": [[0, 'desc']], // Imposta l'ordinamento iniziale sulla prima colonna in ordine decrescente
    "columnDefs": [
        { "targets": 0, "type": "num" } // Tratta la prima colonna come numerica
    ]
});

multipliedRankingTable.clear();

if (response.multipliedResults) {
    Object.entries(response.multipliedResults).forEach(([username, total_value]) => {
        if (username && total_value) {
            multipliedRankingTable.row.add([
                parseFloat(total_value) || 0, // Usa 0 al posto di 'N/A' per valori numerici
                username || 'N/A'
            ]);
        }
    });
    // Forza l'ordinamento e disegna la tabella
    multipliedRankingTable.order([[0, 'desc']]).draw();
} else {
    multipliedRankingTable.row.add(['Error loading multipliers', '']).draw();
}
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error('Error loading ranking data:', textStatus, errorThrown);
        }
    });
}

function loadResourceChart() {
    $.ajax({
        url: 'load_ranking.php',
        type: 'GET',
        dataType: 'json',
        success: function(response) {
            console.log("Response data for chart:", response);

            if (response.resourceTotals) {
                const ctx = document.getElementById('resourceChart').getContext('2d');

                // Estrai le etichette e i dati
                const labels = response.resourceTotals.map(item => item.resource);
                const data = response.resourceTotals.map(item => item.total_amount);

                // Mappa dei colori distintivi per le risorse
const resourceColors = {
    'wood': '#8B4513',              // Marrone legno
    'stone': '#A9A9A9',             // Grigio scuro
    'iron': '#6B6B6B',              // Grigio scuro per il ferro
    'silver': '#C0C0C0',            // Argento
    'gold': '#FFD700',              // Oro
    'amethyst': '#9966CC',          // Viola ametista
    'clay': '#D2691E',              // Terracotta
    'clay_brick': '#FF6347',        // Rosso arancio (diverso da argilla)
    'ruby': '#C72C41',              // Rosso rubino
    'sapphire': '#0033A0',          // Blu zaffiro scuro
    'emerald': '#50C878',           // Verde smeraldo
    'stone_brick': '#7B8D82',       // Mattone verde
    'cotton_thread': '#F0E5DE',     // Beige chiaro
    'wood_plank': '#D4A30A',        // Legno dorato
    'ingot_gold': '#B8860B',        // Oro (mantieni questo come oro)
    'ingot_silver': '#B0C4DE',      // Grigio acciaio (leggermente pi√π chiaro di argento)
    'ingot_iron': '#4B4B4B',        // Grigio scuro per il ferro
    'cotton_thread_brown': '#A0522D', // Marrone chiaro (diverso da legno)
    'cotton_thread_green': '#228B22', // Verde
    'cotton_thread_orange': '#FFA500', // Arancione
    'cotton_thread_red': '#FF4500', // Rosso
    'cotton_thread_yellow': '#FFF700', // Giallo (mantieni lo stesso per continuit√†)
    'cotton_thread_blue': '#0000FF', // Giallo (mantieni lo stesso per continuit√†)
    'wrapped_potato': '#DEB887',    // Beige marrone (diverso da altri marroni)
    'salad': '#66CDAA',      // Verde acqua (diverso dall‚Äôinsalata)
    'mushroom_soup': '#FFE4B5',     // Pesca chiaro (diverso da zuppa di funghi)
    'fries': '#F4A460',      // Sabbia (pi√π distintivo per le patatine)
};


                // Assegna i colori basati sulla mappa delle risorse
                const colors = labels.map(resource => resourceColors[resource.toLowerCase()] || '#FFFFFF');

                // Distruggi il grafico precedente, se esiste
                if (window.myChart) {
                    window.myChart.destroy();
                }

                // Crea un nuovo grafico a torta
                window.myChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Resource Breakdown',
                            data: data,
                            backgroundColor: colors,
                            borderColor: '#fff',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false, // Mantieni flessibilit√† nel ridimensionamento
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right', // Posiziona la legenda a destra
                                labels: {
                                    usePointStyle: true, // Usa puntini nelle etichette
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(tooltipItem) {
                                        return tooltipItem.label + ': ' + tooltipItem.raw + ' units';
                                    }
                                }
                            }
                        },
                        layout: {
                            padding: {
                                left: 10,
                                right: 0,
                                top: 10,
                                bottom: 10
                            }
                        }
                    }
                });
            } else {
                console.error("Expected 'resourceTotals' key in response.");
            }
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error('Error loading chart data:', textStatus, errorThrown);
        }
    });
}


function updateLastLoading() {
    $.ajax({
        url: 'load_last.php', // Your PHP script to get the latest log
        type: 'GET',
        dataType: 'json',
        success: function(response) {
            if (response && response.processed_at) {
                const date = new Date(response.processed_at);

                // Formatta la data originale
                const originalFormattedDate = date.toLocaleString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZoneName: 'short'
                });

                // Aggiungi 7 ore alla data
                date.setHours(date.getHours() + 7);
                const newFormattedDate = date.toLocaleString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZoneName: 'short'
                });

                $('#lastLoadingHeader').html(`Resources <span style="font-size: 0.9em; color: #888;">(Last Loading: ${newFormattedDate})</span>`);
            } else {
                $('#lastLoadingHeader').html('Resources <span style="font-size: 0.9em; color: #888;">(No data available)</span>');
            }
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error('Error fetching the latest log:', textStatus, errorThrown);
            $('#lastLoadingHeader').html('Resources <span style="font-size: 0.9em; color: #888;">(Error loading data)</span>');
        }
    });
}
function updateLastLoading2() {
    $.ajax({
        url: 'load_last.php', // Your PHP script to get the latest log
        type: 'GET',
        dataType: 'json',
        success: function(response) {
            if (response && response.processed_at) {
                const date = new Date(response.processed_at);

                // Formatta la data originale
                const originalFormattedDate = date.toLocaleString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZoneName: 'short'
                });

                // Aggiungi 7 ore alla data
                date.setHours(date.getHours() + 7);
                const newFormattedDate = date.toLocaleString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZoneName: 'short'
                });

                $('#lastLoadingHeader2').html(`Treasury <span style="font-size: 0.9em; color: #888;">(Last Update: ${newFormattedDate})</span>`);
            } else {
                $('#lastLoadingHeader2').html('Treasury <span style="font-size: 0.9em; color: #888;">(No data available)</span>');
            }
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error('Error fetching the latest log:', textStatus, errorThrown);
            $('#lastLoadingHeader2').html('Treasury <span style="font-size: 0.9em; color: #888;">(Error loading data)</span>');
        }
    });
}


updateResourceAmounts();


function updateResourceAmounts() {
    $.ajax({
        url: 'load_amount.php',
        type: 'GET',
        dataType: 'json',
        success: function(response) {
            console.log("Response data for amounts:", response);

            const amounts = {};
            response.forEach(resource => {
                amounts[resource.resource] = Math.floor(parseFloat(resource.total_amount) / 2); // Arrotonda per difetto
            });

            document.querySelectorAll('#resourceTable tbody tr').forEach(row => {
                // Prendere il nome della risorsa e trasformarlo in un formato corrispondente alla risposta del server
                const resourceName = row.cells[1].innerText
                    .toLowerCase()         // Convertire in minuscolo
                    .replace(' ', '_')     // Sostituire spazi con underscore
                    .replace(' ', '_');    // Gestire due spazi nei colori

                // Confrontare con la chiave amounts e aggiornare la tabella
                if (amounts[resourceName]) {
                    row.cells[2].innerText = amounts[resourceName];  // Mostra il valore arrotondato
                }
            });
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error('Error loading resource amounts:', textStatus, errorThrown);
        }
    });
}




updateLastLoading();
updateLastLoading2();
loadResourceChart();
loadInfoData();
loadTable4Data();
loadRankingData();

});
</script>

<script src="theme.js"></script>
</body>
</html>