<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>N≈çmStead Directory</title>
        <!-- Tailwind CSS CDN -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- Font Awesome CDN for icons -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
        />
        <style>
            body {
                font-family: 'Inter', sans-serif;
                background-color: #f3f4f6;
                display: flex;
                justify-content: center;
                align-items: flex-start;
                min-height: 100vh;
                padding: 20px;
            }
                 .toggle-wrapper {
                     display: flex;
                     justify-content: center;
                     align-items: center;
                 }

                 .switch {
                     width: 60px;
                     height: 30px;
                     background: #4f46e5;
                     border-radius: 50px;
                     position: relative;
                     cursor: pointer;
                     transition: background 0.3s ease;
                 }

                 .thumb {
                     width: 24px;
                     height: 24px;
                     background: #e0e7ff;
                     border-radius: 50%;
                     position: absolute;
                     top: 3px;
                     left: 3px;
                     transition: all 0.3s ease;
                 }

                 input:checked + .switch {
                     background: #e0e7ff;
                 }

                 input:checked + .switch .thumb {
                     background: #4f46e5;
                     transform: translateX(30px);
                 }
            .container {
                background-color: #ffffff;
                border-radius: 15px;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
                padding: 30px;
                width: 100%;
                max-width: 800px;
                margin-top: 50px;
            }

                 /* Styles for the header buttons */
                 .header-buttons {
                     display: flex;
                     justify-content: center;
                     gap: 10px; /* Space between buttons */
                     margin-bottom: 25px;
                     flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
                 }
                 .header-buttons .btn-header {
                     padding: 10px 18px;
                     border-radius: 8px;
                     font-weight: 600;
                     cursor: pointer;
                     transition:
                         background-color 0.2s,
                         transform 0.1s;
                     background-color: #e0e7ff; /* Lighter blue background */
                     color: #4f46e5; /* Darker blue text */
                     box-shadow: 0 2px 4px rgba(79, 70, 229, 0.1);
                     border: 1px solid #c7d2fe;
                 }
                 .header-buttons .btn-header:hover {
                     background-color: #c7d2fe; /* Slightly darker on hover */
                     transform: translateY(-1px);
                 }
                 @media (max-width: 768px) {
                     .header-buttons {
                         display: flex;
                         justify-content: center;
                         gap: 3px; /* Space between buttons */
                         margin-bottom: 11px;
                         flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
                         font-size: 4vw;
                     }
                     .header-buttons .btn-header {
                         padding: 5px 9px;
                         border-radius: 4px;
                         font-weight: 450;
                         cursor: pointer;
                         transition:
                             background-color 0.2s,
                             transform 0.1s;
                         background-color: #e0e7ff; /* Lighter blue background */
                         color: #4f46e5; /* Darker blue text */
                         box-shadow: 0 1px 3px rgba(79, 70, 229, 0.1);
                         border: 1px solid #c7d2fe;
                     }
                     .header-buttons .btn-header:hover {
                         background-color: #c7d2fe; /* Slightly darker on hover */
                         t
                     }
                 }
            .input-group {
                margin-bottom: 15px;
            }
            .input-group label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                color: #374151;
            }
            .input-group input,
            .input-group select {
                width: 100%;
                padding: 12px;
                border: 1px solid #d1d5db;
                border-radius: 8px;
                font-size: 1rem;
                transition: border-color 0.2s;
            }
            .input-group input:focus,
            .input-group select:focus {
                outline: none;
                border-color: #4f46e5;
                box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
            }
            .btn {
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: background-color 0.2s, transform 0.1s;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }
            .btn-primary {
                background-color: #4f46e5;
                color: #ffffff;
                box-shadow: 0 4px 6px rgba(79, 70, 229, 0.3);
            }
            .btn-primary:hover {
                background-color: #4338ca;
                transform: translateY(-1px);
            }
            .btn-secondary {
                background-color: #6b7280;
                color: #ffffff;
                box-shadow: 0 4px 6px rgba(107, 114, 128, 0.3);
                margin-left: 10px;
            }
            .btn-secondary:hover {
                background-color: #4b5563;
                transform: translateY(-1px);
            }
            .btn-danger {
                background-color: #ef4444;
                color: #ffffff;
                box-shadow: 0 4px 6px rgba(239, 68, 68, 0.3);
            }
            .btn-danger:hover {
                background-color: #dc2626;
                transform: translateY(-1px);
            }
            .link-list {
                margin-top: 30px;
                border-top: 1px solid #e5e7eb;
                padding-top: 20px;
            }
            .link-item {
                display: flex;
                align-items: center;
                background-color: #f9fafb;
                border: 1px solid #e5e7eb;
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 15px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                transition: transform 0.2s, box-shadow 0.2s;
                cursor: pointer; /* Indicate clickability for the whole item */
                gap: 15px; /* Spacing between icon, details, and actions */
            }
            .link-item:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            /* Drag and Drop Styles */
            .link-item.dragging {
                opacity: 0.5;
                border: 2px dashed #4f46e5;
            }
            .link-item.drag-over {
                border: 2px solid #4f46e5;
                box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3);
            }
            .link-item .icon-container {
                width: 40px;
                height: 40px;
                min-width: 40px; /* Ensure it doesn't shrink */
                min-height: 40px; /* Ensure it doesn't shrink */
                display: flex;
                align-items: center;
                justify-content: center;
                background-color: #e0e7ff;
                border-radius: 8px;
                color: #4f46e5;
                font-size: 1.2rem;
                overflow: hidden; /* Hide overflow for image icons */
            }
            .link-item .icon-container img {
                width: 100%;
                height: 100%;
                object-fit: cover; /* Cover the container */
            }
            .link-item .details {
                flex-grow: 1;
                /* Ensure title and URL stack vertically within details */
                display: flex;
                flex-direction: column;
                justify-content: center;
                min-width: 0; /* Allow content to shrink if needed, preventing overflow */
            }


            .link-item .details .link-title { /* Added class for title for clarity */
                font-size: 1.1rem;
                font-weight: 600;
                color: #1f2937;
                text-decoration: none; /* Remove underline by default */
                word-break: break-all; /* Break long URLs */
                margin-bottom: 2px; /* Small space between title and URL */
                line-height: 1.3; /* Improve readability for multi-line titles */
            }
            .link-item .details .link-url { /* Added class for url for clarity */
                font-size: 0.9rem;
                color: #6b7280;
                word-break: break-all; /* Break long URLs */
                line-height: 1.3;
            }
            .link-item .details .link-title:active {
                color: rgb(22 101 52 / var(--tw-text-opacity, 1));
            }
            .link-item .details .link-title:hover {
                color: #4f46e5;
            }

            /*
            .link-item .details a {
                font-size: 1.1rem;
                font-weight: 600;
                color: #1f2937;
                text-decoration: none;
                word-break: break-all;
            }
            .link-item .details a:hover {
                color: #4f46e5;
            }
            .link-item .details p {
                font-size: 0.9rem;
                color: #6b7280;
                word-break: break-all;
            }
            */

            .link-item .actions {
                display: flex;
                gap: 8px; /* Space between action buttons */
            }
            .link-item .actions button {
                background: none;
                border: none;
                color: #4f46e5; /* Default action button color */
                cursor: pointer;
                font-size: 1.1rem;
                transition: color 0.2s;
                padding: 5px; /* Add padding for easier clicking */
                border-radius: 5px;
            }
            .link-item .actions button:hover {
                background-color: #e0e7ff;
            }
            .link-item .actions .delete-btn {
                color: #dc2626; /* Specific color for delete */
            }
            .link-item .actions .delete-btn:hover {
                background-color: #fee2e2;
            }
            .modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s, visibility 0.3s;
            }
            .modal.show {
                opacity: 1;
                visibility: visible;
            }
            .modal-content {
                background-color: #ffffff;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                width: 90%;
                max-width: 400px;
                text-align: center;
                transform: translateY(-20px);
                transition: transform 0.3s;
            }
            .modal.show .modal-content {
                transform: translateY(0);
            }
            .modal-content h3 {
                font-size: 1.5rem;
                font-weight: 700;
                color: #1f2937;
                margin-bottom: 15px;
            }
            .modal-content p {
                color: #4b5563;
                margin-bottom: 25px;
            }
            .modal-content button {
                background-color: #4f46e5;
                color: #ffffff;
                padding: 10px 20px;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: background-color 0.2s;
            }
            .modal-content button:hover {
                background-color: #4338ca;
            }
            /* Styles for confirmation modal, distinct from general message modal */
            #confirmationModal .modal-content {
                padding: 25px;
            }
            #confirmationModal .modal-buttons {
                display: flex;
                justify-content: center;
                gap: 15px;
                margin-top: 20px;
            }
            #confirmationModal .modal-buttons button {
                flex: 1;
                max-width: 120px;
            }
            #confirmationModal .modal-buttons .btn-cancel {
                background-color: #ef4444;
            }
            #confirmationModal .modal-buttons .btn-cancel:hover {
                background-color: #dc2626;
            }
            .button-row {
                display: flex;
                justify-content: flex-end; /* Align buttons to the right */
                gap: 10px; /* Space between buttons */
                margin-top: 20px;
                flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
            }
            .button-row .btn {
                margin-left: 0; /* Override default margin-left for .btn-secondary */
            }
        </style>
    </head>
    <body>
        <div class="container">
            <button id="sYLb" onclick="changeio();" style="float: right">
                ‚ö™
            </button>
            <div class="header-buttons">
                <button
                    class="btn-header"
                    onclick="window.open('https://nomstead.com/The-47th-Society/62a3030c1b7f268d4bcfcd03', '_blank')"
                >
                    <i class="fa-solid fa-house mr-2"></i> 47th Kingdom
                </button>
                <button
                    class="btn-header"
                    onclick="window.open('https://nomstead.com/The-47th-Society/650925764ca8e147b10054e5', '_blank')"
                >
                    <i class="fa-solid fa-leaf mr-2"></i> Ahnx Respite
                </button>
                <button
                    class="btn-header"
                    onclick="window.open('https://nomstead.com/The-47th-Society/65c106417d8c2c075d336757', '_blank')"
                >
                    <i class="fa-solid fa-mountain mr-2"></i> Ourorax Range
                </button>
                <button
                    class="btn-header"
                    onclick="window.open('https://nomstead.com/The-47th-Society/65c106417d8c2c075d336757', '_blank')"
                >
                    <i class="fa-solid fa-gear mr-2"></i> Dubrok Mill
                </button>
                <button
                    class="btn-header"
                    onclick="window.open('https://nomstead.com/The-47th-Society/663cbf92f38cf3334950c41a', '_blank')"
                >
                    <i class="fa-solid fa-tint mr-2"></i> Society Thread
                </button>
            </div>
            <div class="header-buttons">
                <button
                    class="btn-header"
                    onclick="window.open('https://www.youtube.com/@DataTheDestroyer', '_blank')"
                >
                    <i class="fa-brands fa-youtube mr-2"></i> YouTube
                </button>
                <button
                    class="btn-header"
                    onclick="window.open('https://odysee.com/@d474th3d357r0y3r', '_blank')"
                >
                    <i class="fa-solid fa-fire mr-2"></i> Odysee
                </button>
                <button
                    class="btn-header"
                    onclick="window.open('https://d474com.wordpress.com/', '_blank')"
                >
                    <i class="fa-brands fa-wordpress mr-2"></i> WordPress
                </button>
                <button
                    class="btn-header"
                    onclick="window.open('https://discord.gg/gnDVaZF53h', '_blank')"
                >
                    <i class="fa-brands fa-discord mr-2"></i> Discord
                </button>
                <button
                    class="btn-header"
                    onclick="window.open('https://www.reddit.com/r/47thSociety', '_blank')"
                >
                    <i class="fa-brands fa-reddit mr-2"></i> Reddit
                </button>
            </div>
            <div class="header-buttons">
                <button
                    class="btn-header"
                    onclick="window.open('https://nomstead.com/nomura/60555c57b90cbe0ff06cde9e', '_blank')"
                >
                    <i class="fa-solid fa-user-cog mr-2"></i> Tom
                </button>
                <button
                    class="btn-header"
                    onclick="window.open('https://nomstead.com/nomura/6029eae39c6d299b75aa5875', '_blank')"
                >
                    <i class="fa-solid fa-user-minus mr-2"></i> Sarah
                </button>
                <button
                    class="btn-header"
                    onclick="window.open('https://nomstead.com/nomura/6063f48645d88f0fafc3c0f6', '_blank')"
                >
                    <i class="fa-solid fa-user-plus mr-2"></i> Lily
                </button>
                <button
                    class="btn-header"
                    onclick="window.open('https://nomstead.com/nomura/5f76ab6a61b079cf08f25df9', '_blank')"
                >
                    <i class="fa-solid fa-user-clock mr-2"></i> Gus
                </button>
            </div>

            <div
                class="link-list"
                id="linkList"
                style="scroll-margin-top: 10vh"
            >
                <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">
                    <button
                        id="adder"
                        onclick="addition();"
                        style="float: left; background: #e5e7eb"
                    >
                        &nbsp;&nbsp;+&nbsp;&nbsp;
                    </button>
                    Directory Listings:
                </h1>
                <!-- Links will be dynamically added here -->
                <p id="noLinksMessage" class="text-gray-500 text-center">
                    No links saved yet; Add one above!
                </p>
            </div>

            <h2 class="text-2xl font-bold text-center text-green-800 mb-8">
                <a href="https://nomstead.com/?ref=btrpazme" target="_blank"
                    >Join N≈çmStead Now!<br />Click Here And Join The Forty
                    Seventh Society!</a
                >
            </h2>

            <h1
                class="text-4xl font-bold text-center text-gray-800 mb-8"
                onclick="toggleVisibility()"
                id="linker"
            >
                Save Your Links!
            </h1>
            <center>
                <div class="toggle-wrapper">
                    <input type="checkbox" id="toggle" hidden />
                    <label for="toggle" class="switch">
                        <div class="thumb"></div>
                    </label>
                </div>
            </center>

            <div id="saveables" style="display: none">
                <div class="input-group">
                    <label for="linkUrl">Link</label>
                    <input
                        type="url"
                        id="linkUrl"
                        style="scroll-margin-top: 10vh"
                        placeholder="e.g., https://www.example.com/page"
                        required
                    />
                </div>

                <div class="input-group">
                    <label for="linkTitle">Title</label>
                    <input
                        type="text"
                        id="linkTitle"
                        placeholder="e.g., My Favorite Page"
                        required
                    />
                </div>

                <div class="input-group">
                    <label for="iconType">Icon</label>
                    <select
                        id="iconType"
                        class="w-full p-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    >
                        <option value="fa">Font Awesome Icon</option>
                        <option value="url">Image URL</option>
                    </select>
                </div>

                <div class="input-group" id="iconInputGroup">
                    <label for="linkIcon"
                        >Font Awesome Icon Class (e.g., fa-solid fa-star)</label
                    >
                    <input
                        type="text"
                        id="linkIcon"
                        placeholder="e.g., fa-solid fa-star"
                    />
                </div>

                <div class="button-row">
                    <button id="mainActionButton" class="btn btn-primary">
                        <i class="fas fa-plus mr-2"></i> Add Link
                    </button>
                    <button id="cancelEditBtn" class="btn btn-danger hidden">
                        <i class="fas fa-times mr-2"></i> Cancel Edit
                    </button>
                    <button id="downloadBackupBtn" class="btn btn-secondary">
                        <i class="fas fa-download mr-2"></i> Download Backup
                    </button>
                    <input
                        type="file"
                        id="uploadBackupInput"
                        accept=".json"
                        class="hidden"
                    />
                    <button id="uploadBackupBtn" class="btn btn-secondary">
                        <i class="fas fa-upload mr-2"></i> Upload Backup
                    </button>
                </div>
            </div>
        </div>

        <!-- General Message Modal -->
        <div id="messageModal" class="modal">
            <div class="modal-content">
                <h3 id="modalTitle"></h3>
                <p id="modalMessage"></p>
                <button id="modalCloseBtn">OK</button>
            </div>
        </div>

        <!-- Confirmation Modal (for delete) -->
        <div id="confirmationModal" class="modal">
            <div class="modal-content">
                <h3 id="confirmModalTitle">Confirm Action</h3>
                <p id="confirmModalMessage"></p>
                <div class="modal-buttons">
                    <button id="confirmYesBtn" class="btn btn-primary">
                        Yes
                    </button>
                    <button
                        id="confirmNoBtn"
                        class="btn btn-cancel"
                    >
                        No
                    </button>
                </div>
            </div>
        </div>

        <script>
            function toggleVisibility() {
                var element = document.getElementById("saveables");
                if (element.style.display === "none") {
                    element.style.display = "block";
                } else {
                    element.style.display = "none";
                }
            }
            document
                .getElementById("toggle")
                .addEventListener("change", (e) => {
                    toggleVisibility();
                });

            const checkbox = document.getElementById("toggle");
            const toggleButton = document.getElementById("linker");

            toggleButton.addEventListener("click", () => {
                checkbox.checked = !checkbox.checked;
            });

            function getRandomHexColor() {
                // Generate a random integer between 0 and 16777215 (which is FFFFFF in hexadecimal)
                const randomInt = Math.floor(Math.random() * 16777216);

                // Convert the integer to a hexadecimal string
                let hexColor = randomInt.toString(16);

                // Pad the hexadecimal string with leading zeros if necessary to ensure 6 characters
                while (hexColor.length < 6) {
                    hexColor = "0" + hexColor;
                }

                // Prepend '#' to form a valid CSS hexadecimal color code
                return "#" + hexColor;
            }

            function changeio() {
                let color = getRandomHexColor();
                document.body.style.background = color;
                console.log(color); // e.g., #a3b4c5
            }

            const emojis = [
                "üôÇ",
                "üî•",
                "üëç",
                "üêù",
                "üåê",
                "üíå",
                "‚úåÔ∏è",
                "üéüÔ∏è",
                "üí∞",
                "‚è≥",
                "üîî",
                "üìØ",
                "üó°Ô∏è",
                "üõ°Ô∏è",
                "‚ö™",
                "üóØÔ∏è",
                "üò∂‚Äç",
                "ü§£",
                "ü¶ù",
            ];
            function changeEmoji() {
                const randomIndex = Math.floor(Math.random() * emojis.length);
                const randomEmoji = emojis[randomIndex];
                document.getElementById("sYLb").textContent = randomEmoji;
            }
            document
                .getElementById("sYLb")
                .addEventListener("click", changeEmoji);

            function addition() {
                var element = document.getElementById("saveables");
                if (element.style.display === "none") {
                    element.style.display = "block";
                    checkbox.checked = !checkbox.checked;
                    document
                        .getElementById("linkUrl")
                        .scrollIntoView({ behavior: "smooth" });
                    console.log("Tracing... [Adder]");
                }
            }
        </script>

        <script type="module">
            function toggleVisibilityEdit() {
                var element = document.getElementById("saveables");
                if (element.style.display === "none") {
                    element.style.display = "block";
                    checkbox.checked = !checkbox.checked;
                    document
                        .getElementById("linkUrl")
                        .scrollIntoView({ behavior: "smooth" });
                    console.log("Tracing... [FS]");
                }
            }

            function toggleVisibilityCancel() {
                var element = document.getElementById("saveables");
                if (element.style.display === "block") {
                    element.style.display = "none";
                    checkbox.checked = !checkbox.checked;
                    document
                        .getElementById("linkList")
                        .scrollIntoView({ behavior: "smooth" });
                    console.log("Tracing... [S]");
                }
            }

            /*
            function updateScroll() {
                var element = document.getElementById("saveables");
                if (element.style.display === "block") {
                    element.style.display = "none";
                    checkbox.checked = !checkbox.checked;
                }
                document
                    .getElementById("messageModal")
                    .scrollIntoView({ behavior: "smooth" });
                console.log("Tracing... [Forty Seven]");
            }

            const mainButton = document.getElementById("mainActionButton");
            mainButton.addEventListener("click", function (e) {
                updateScroll();
            });
            */

            document
                .getElementById("mainActionButton")
                .addEventListener("click", function () {
                    const modalContent = document.querySelector(".container"); // Or your specific selector
                    modalContent.scrollIntoView({
                        behavior: "smooth", // Optional: for smooth scrolling animation
                        block: "center", // Aligns the top of the element with the top of the visible area
                    });
                    var element = document.getElementById("saveables");
                    if (element.style.display === "block") {
                        element.style.display = "none";
                        checkbox.checked = !checkbox.checked;
                    }
                    console.log("Tracing... [Forty Seven]");
                });

            function deleteScroll() {
                const modalContent2 = document.querySelector(".container"); // Or your specific selector
                modalContent2.scrollIntoView({
                    behavior: "smooth", // Optional: for smooth scrolling animation
                    block: "center", // Aligns the top of the element with the top of the visible area
                });
                console.log("Tracing... [CTRL + ALT + DEL]");
            }

            function okScroll() {
                document
                    .getElementById("linkList")
                    .scrollIntoView({ behavior: "smooth" });
                console.log("Tracing... [Seventy Four]");
            }

            const okButton = document.getElementById("modalCloseBtn");
            okButton.addEventListener("click", function (e) {
                okScroll();
            });

            function noScroll() {
                document
                    .getElementById("linkList")
                    .scrollIntoView({ behavior: "smooth" });
                console.log("Tracing... [Nya]");
            }

            const noButton = document.getElementById("confirmNoBtn");
            noButton.addEventListener("click", function (e) {
                noScroll();
            });

            const STORAGE_KEY = "linkSaverLinks"; // Key for localStorage

            const linkListDiv = document.getElementById("linkList");
            const noLinksMessage = document.getElementById("noLinksMessage");
            const mainActionButton =
                document.getElementById("mainActionButton"); // Renamed from addLinkBtn
            const cancelEditBtn = document.getElementById("cancelEditBtn");
            cancelEditBtn.addEventListener("click", () =>
                toggleVisibilityCancel(),
            );
            const downloadBackupBtn =
                document.getElementById("downloadBackupBtn");
            const uploadBackupBtn = document.getElementById("uploadBackupBtn");
            const uploadBackupInput =
                document.getElementById("uploadBackupInput");
            const linkUrlInput = document.getElementById("linkUrl");
            const linkTitleInput = document.getElementById("linkTitle");
            const linkIconInput = document.getElementById("linkIcon");
            const iconTypeSelect = document.getElementById("iconType");
            const iconInputGroup = document.getElementById("iconInputGroup");

            // Message Modal elements
            const messageModal = document.getElementById("messageModal");
            const modalTitle = document.getElementById("modalTitle");
            const modalMessage = document.getElementById("modalMessage");
            const modalCloseBtn = document.getElementById("modalCloseBtn");

            // Confirmation Modal elements
            const confirmationModal =
                document.getElementById("confirmationModal");
            const confirmModalTitle =
                document.getElementById("confirmModalTitle");
            const confirmModalMessage = document.getElementById(
                "confirmModalMessage",
            );
            const confirmYesBtn = document.getElementById("confirmYesBtn");
            const confirmNoBtn = document.getElementById("confirmNoBtn");

            let links = []; // Array to hold all link objects
            let editingLinkId = null; // Stores the ID of the link being edited
            let draggedItem = null; // Stores the HTML element being dragged

            // Function to show custom message modal
            function showMessage(title, message) {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                messageModal.classList.add("show");
            }

            // Function to hide custom message modal
            function hideMessage() {
                modalMessage.textContent = "";
                modalTitle.textContent = "";
                messageModal.classList.remove("show");
            }

            modalCloseBtn.addEventListener("click", hideMessage);

            // Function to show custom confirmation modal
            function showConfirmation(title, message, onConfirm) {
                confirmModalTitle.textContent = title;
                confirmModalMessage.textContent = message;
                confirmationModal.classList.add("show");

                // Remove previous listeners to prevent multiple calls
                confirmYesBtn.onclick = null;
                confirmNoBtn.onclick = null;

                confirmYesBtn.onclick = () => {
                    hideConfirmation();
                    onConfirm(true);
                };
                confirmNoBtn.onclick = () => {
                    hideConfirmation();
                    onConfirm(false);
                };
            }

            // Function to hide custom confirmation modal
            function hideConfirmation() {
                confirmationModal.classList.remove("show");
            }

            // Handle icon type change
            iconTypeSelect.addEventListener("change", (event) => {
                if (event.target.value === "fa") {
                    linkIconInput.placeholder = "e.g., fa-solid fa-star";
                    iconInputGroup.querySelector("label").textContent =
                        "Font Awesome Icon Class (e.g., fa-solid fa-star)";
                } else {
                    linkIconInput.placeholder =
                        "e.g., https://www.example.com/icon.png";
                    iconInputGroup.querySelector("label").textContent =
                        "Image URL (e.g., https://www.example.com/icon.png)";
                }
            });

            /**
             * Saves the current links array to localStorage.
             */
            function saveLinksToLocalStorage() {
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(links));
                } catch (e) {
                    showMessage(
                        "Storage Error",
                        "Could not save links. Local storage might be full, or unavailable.",
                    );
                    console.error("Error saving to localStorage:", e);
                }
            }

            /**
             * Loads links from localStorage and updates the global links array.
             */
            function loadLinksFromLocalStorage() {
                try {
                    const storedLinks = localStorage.getItem(STORAGE_KEY);
                    if (storedLinks) {
                        links = JSON.parse(storedLinks);
                        // Ensure timestamps are numbers
                        links.forEach((link) => {
                            if (typeof link.timestamp === "string") {
                                link.timestamp = new Date(
                                    link.timestamp,
                                ).getTime();
                            }
                        });
                    } else {
                        links = [];
                    }
                    displayLinks();
                } catch (e) {
                    showMessage(
                        "Storage Error",
                        "Could not load links due to an error.",
                    );
                    console.error("Error loading from localStorage:", e);
                    links = []; // Reset links on error
                }
            }

            /**
             * Dynamically displays links in the UI.
             */
            function displayLinks() {
                // Clear existing links except the heading and message
                const existingLinkItems =
                    linkListDiv.querySelectorAll(".link-item");
                existingLinkItems.forEach((item) => item.remove());

                if (links.length === 0) {
                    noLinksMessage.style.display = "block";
                    return;
                } else {
                    noLinksMessage.style.display = "none";
                }

                links.forEach((link) => {
                    const linkItem = document.createElement("div");
                    linkItem.className = "link-item";
                    linkItem.dataset.id = link.id;
                    linkItem.draggable = true; // Make the item draggable

                    // Drag and Drop Event Listeners
                    linkItem.addEventListener("dragstart", handleDragStart);
                    linkItem.addEventListener("dragover", handleDragOver);
                    linkItem.addEventListener("dragleave", handleDragLeave);
                    linkItem.addEventListener("drop", handleDrop);
                    linkItem.addEventListener("dragend", handleDragEnd);

                    // Event listener for the entire link item (for navigation)
                    linkItem.addEventListener("click", (event) => {
                        // Check if the click originated from an action button (edit/delete)
                        // If so, prevent the navigation to allow the button's action to proceed
                        if (event.target.closest(".actions button")) {
                            return;
                        }
                        window.open(link.url, "_blank"); // Open the link in a new tab
                    });

                    const iconContainer = document.createElement("div");
                    iconContainer.className = "icon-container";

                    if (link.iconType === "url" && link.icon) {
                        const img = document.createElement("img");
                        img.src = link.icon;
                        img.alt = link.title || "Link icon";
                        img.onerror = () => {
                            img.src =
                                "https://placehold.co/40x40/cccccc/333333?text=IMG"; // Placeholder on error
                        };
                        iconContainer.appendChild(img);
                    } else if (link.icon) {
                        const icon = document.createElement("i");
                        icon.className = link.icon; // Assume Font Awesome class
                        iconContainer.appendChild(icon);
                    } else {
                        const defaultIcon = document.createElement("i");
                        defaultIcon.className = "fa-solid fa-link"; // Default icon if none provided
                        iconContainer.appendChild(defaultIcon);
                    }

                    const detailsDiv = document.createElement("div");
                    detailsDiv.className = "details";

                    // Title element - now a span, as the whole item is clickable
                    const linkTitleSpan = document.createElement("span");
                    linkTitleSpan.className = "link-title";
                    linkTitleSpan.textContent = link.title || link.url; // Display title, fallback to URL

                    // URL paragraph - separate line
                    const urlParagraph = document.createElement("p");
                    urlParagraph.className = "link-url";
                    urlParagraph.textContent = link.url;

                    detailsDiv.appendChild(linkTitleSpan);
                    detailsDiv.appendChild(urlParagraph);

                    const actionsDiv = document.createElement("div");
                    actionsDiv.className = "actions";

                    // Edit Button
                    const editButton = document.createElement("button");
                    editButton.innerHTML = '<i class="fas fa-edit"></i>';
                    editButton.id = "editBtn";
                    editButton.title = "Edit Link";
                    editButton.addEventListener("click", (event) => {
                        event.stopPropagation(); // Prevent click from bubbling up to linkItem
                        editLink(link.id);
                    });
                    editButton.addEventListener("click", () =>
                        toggleVisibilityEdit(),
                    );
                    actionsDiv.appendChild(editButton);

                    // Delete Button
                    const deleteButton = document.createElement("button");
                    deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
                    deleteButton.title = "Delete Link";
                    deleteButton.className = "delete-btn"; // Add specific class for styling
                    deleteButton.addEventListener("click", (event) => {
                        deleteScroll();
                        event.stopPropagation(); // Prevent click from bubbling up to linkItem
                        showConfirmation(
                            "Confirm Deletion",
                            `Are you sure you want to delete "${link.title || link.url}"?`,
                            (confirmed) => {
                                if (confirmed) {
                                    // Filter out the link to be deleted
                                    links = links.filter(
                                        (item) => item.id !== link.id,
                                    );
                                    saveLinksToLocalStorage();
                                    displayLinks(); // Re-render the list
                                    showMessage(
                                        "Success",
                                        "Link deleted successfully!",
                                    );
                                    // If the deleted link was being edited, cancel edit mode
                                    if (editingLinkId === link.id) {
                                        cancelEdit();
                                    }
                                }
                            },
                        );
                    });
                    actionsDiv.appendChild(deleteButton);

                    linkItem.appendChild(iconContainer);
                    linkItem.appendChild(detailsDiv);
                    linkItem.appendChild(actionsDiv);

                    linkListDiv.appendChild(linkItem);
                });
            }

            /**
             * Drag and Drop Handlers
             */
            function handleDragStart(e) {
                draggedItem = this; // 'this' refers to the linkItem being dragged
                e.dataTransfer.effectAllowed = "move";
                e.dataTransfer.setData("text/plain", this.dataset.id); // Store the ID of the dragged item
                setTimeout(() => {
                    this.classList.add("dragging"); // Add dragging class after a short delay
                }, 0);
            }

            function handleDragOver(e) {
                e.preventDefault(); // Necessary to allow dropping
                if (
                    e.target.closest(".link-item") &&
                    e.target.closest(".link-item") !== draggedItem
                ) {
                    const targetItem = e.target.closest(".link-item");
                    // Determine if we are dragging over the top or bottom half of the target item
                    const rect = targetItem.getBoundingClientRect();
                    const offsetY = e.clientY - rect.top;
                    const isAfter = offsetY > rect.height / 2;

                    // Remove drag-over from all items first
                    document
                        .querySelectorAll(".link-item")
                        .forEach((item) => item.classList.remove("drag-over"));

                    // Add drag-over to the target item
                    targetItem.classList.add("drag-over");
                }
            }

            function handleDragLeave(e) {
                e.target.closest(".link-item")?.classList.remove("drag-over");
            }

            function handleDrop(e) {
                e.preventDefault();
                const targetItem = e.target.closest(".link-item");

                if (targetItem && targetItem !== draggedItem) {
                    const draggedId = draggedItem.dataset.id;
                    const targetId = targetItem.dataset.id;

                    const draggedIndex = links.findIndex(
                        (link) => link.id === draggedId,
                    );
                    const targetIndex = links.findIndex(
                        (link) => link.id === targetId,
                    );

                    if (draggedIndex !== -1 && targetIndex !== -1) {
                        const [removed] = links.splice(draggedIndex, 1); // Remove dragged item
                        links.splice(targetIndex, 0, removed); // Insert at target position

                        saveLinksToLocalStorage();
                        displayLinks(); // Re-render to reflect new order
                    }
                }
                // Clean up drag-over class from all items
                document
                    .querySelectorAll(".link-item")
                    .forEach((item) => item.classList.remove("drag-over"));
            }

            function handleDragEnd(e) {
                this.classList.remove("dragging"); // Remove dragging class from the original item
                // Ensure any lingering drag-over classes are removed
                document
                    .querySelectorAll(".link-item")
                    .forEach((item) => item.classList.remove("drag-over"));
                draggedItem = null; // Clear dragged item reference
            }

            /**
             * Enters edit mode for a specific link.
             * @param {string} id - The ID of the link to edit.
             */
            function editLink(id) {
                const linkToEdit = links.find((link) => link.id === id);
                if (linkToEdit) {
                    editingLinkId = id;
                    linkUrlInput.value = linkToEdit.url;
                    linkTitleInput.value = linkToEdit.title;
                    linkIconInput.value = linkToEdit.icon || "";
                    iconTypeSelect.value = linkToEdit.iconType || "fa";
                    iconTypeSelect.dispatchEvent(new Event("change")); // Trigger change to update label/placeholder

                    mainActionButton.innerHTML =
                        '<i class="fas fa-save mr-2"></i> Update Link';
                    mainActionButton.classList.remove("btn-primary");
                    mainActionButton.classList.add("btn-secondary"); // Use secondary style for update
                    cancelEditBtn.classList.remove("hidden");
                } else {
                    showMessage("Error", "Link not found for editing.");
                }
            }

            /**
             * Exits edit mode and clears the form.
             */
            function cancelEdit() {
                editingLinkId = null;
                linkUrlInput.value = "";
                linkTitleInput.value = "";
                linkIconInput.value = "";
                iconTypeSelect.value = "fa";
                iconTypeSelect.dispatchEvent(new Event("change")); // Trigger change to update label/placeholder

                mainActionButton.innerHTML =
                    '<i class="fas fa-plus mr-2"></i> Add Link';
                mainActionButton.classList.remove("btn-secondary");
                mainActionButton.classList.add("btn-primary");
                cancelEditBtn.classList.add("hidden");
            }

            // Main action button (Add/Update)
            mainActionButton.addEventListener("click", () => {
                const url = linkUrlInput.value.trim();
                const title = linkTitleInput.value.trim();
                const icon = linkIconInput.value.trim();
                const iconType = iconTypeSelect.value;

                if (!url) {
                    showMessage("Validation Error", "Link URL is required.");
                    return;
                }

                // Basic URL validation
                try {
                    new URL(url);
                } catch (e) {
                    showMessage(
                        "Validation Error",
                        "Please enter a valid URL.",
                    );
                    return;
                }

                if (editingLinkId) {
                    // Update existing link
                    const index = links.findIndex(
                        (link) => link.id === editingLinkId,
                    );
                    if (index !== -1) {
                        links[index].url = url;
                        links[index].title = title;
                        links[index].icon = icon;
                        links[index].iconType = iconType;
                        // Optionally update timestamp if you want "last modified" behavior
                        // links[index].timestamp = Date.now();
                        saveLinksToLocalStorage();
                        displayLinks();
                        showMessage("Success", "Link updated successfully!");
                        cancelEdit(); // Exit edit mode
                    } else {
                        showMessage("Error", "Could not find link to update.");
                    }
                } else {
                    // Add new link
                    const newLinkId =
                        Date.now().toString() +
                        Math.random().toString(36).substring(2, 9);
                    const newLink = {
                        id: newLinkId,
                        url: url,
                        title: title,
                        icon: icon,
                        iconType: iconType,
                        timestamp: Date.now(), // Store timestamp as a number
                    };

                    links.unshift(newLink); // Add new link to the beginning of the array
                    // No need to sort by timestamp here, as drag-and-drop will determine order
                    saveLinksToLocalStorage();
                    displayLinks(); // Re-render the list

                    showMessage("Success", "Link added successfully!");
                    // Clear input fields
                    linkUrlInput.value = "";
                    linkTitleInput.value = "";
                    linkIconInput.value = "";
                    iconTypeSelect.value = "fa"; // Reset to default
                    iconTypeSelect.dispatchEvent(new Event("change")); // Trigger change event to update label/placeholder
                }
            });

            // Cancel Edit button listener
            cancelEditBtn.addEventListener("click", cancelEdit);

            // Download backup
            downloadBackupBtn.addEventListener("click", () => {
                try {
                    const jsonString = JSON.stringify(links, null, 2);
                    const blob = new Blob([jsonString], {
                        type: "application/json",
                    });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = `link_saver_backup_${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    showMessage("Success", "Backup downloaded successfully!");
                } catch (e) {
                    showMessage(
                        "Error",
                        `Error downloading backup: ${e.message}`,
                    );
                    console.error("Error downloading backup:", e);
                }
            });

            // Upload backup
            uploadBackupBtn.addEventListener("click", () => {
                uploadBackupInput.click(); // Trigger the hidden file input click
            });

            uploadBackupInput.addEventListener("change", (event) => {
                const file = event.target.files[0];
                if (!file) {
                    return;
                }

                if (file.type !== "application/json") {
                    showMessage(
                        "Invalid File Type",
                        "Please upload a JSON file.",
                    );
                    // Clear the file input value to allow re-uploading the same file if needed
                    uploadBackupInput.value = "";
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const uploadedData = JSON.parse(e.target.result);

                        if (!Array.isArray(uploadedData)) {
                            showMessage(
                                "Invalid Data",
                                "The uploaded JSON file does not contain a valid array of links.",
                            );
                            uploadBackupInput.value = "";
                            return;
                        }

                        // Add uploaded links, generating new IDs to avoid conflicts
                        uploadedData.forEach((uploadedLink) => {
                            // Basic validation for uploaded link structure
                            if (uploadedLink.url) {
                                const newLinkId =
                                    Date.now().toString() +
                                    Math.random().toString(36).substring(2, 9);
                                links.push({
                                    id: newLinkId,
                                    url: uploadedLink.url,
                                    title: uploadedLink.title || "",
                                    icon: uploadedLink.icon || "",
                                    iconType: uploadedLink.iconType || "fa",
                                    timestamp:
                                        uploadedLink.timestamp || Date.now(), // Use existing or new timestamp
                                });
                            }
                        });
                        saveLinksToLocalStorage();
                        displayLinks();
                        showMessage(
                            "Upload Success",
                            `${uploadedData.length} links uploaded and added to your list.`,
                        );
                    } catch (parseError) {
                        showMessage(
                            "Parsing Error",
                            `Error parsing JSON file: ${parseError.message}`,
                        );
                        console.error(
                            "Error parsing uploaded JSON:",
                            parseError,
                        );
                    } finally {
                        // Clear the file input value after processing
                        uploadBackupInput.value = "";
                    }
                };

                reader.onerror = () => {
                    showMessage("File Read Error", "Failed to read the file.");
                    console.error("Error reading file:", reader.error);
                    uploadBackupInput.value = "";
                };

                reader.readAsText(file);
            });

            // Load links when the window loads
            window.onload = loadLinksFromLocalStorage;
        </script>
    </body>
</html>
